# 学生成绩管理系统

[TOC]

------

## 1  新建项目

### 1.1 根据向导创建项目

首先，新建MFC项目(SaleSystem)，基于单文档，MFC标准项目，同时，去掉工具栏：

<img src="D:\photos\微信图片_20220112213853.png" alt="微信图片_20220112213853" style="zoom:80%;" />

<img src="D:\photos\微信图片_20220112214358.png" style="zoom:80%;" />

------

### 1.2  添加预处理指令

由于微软在VS2013中不建议再使用C/C++的传统库函数scanf,strcpy,sprintf等，所以直接使用这些库函数会提示C4996错误。

VS建议采用带_s的函数，如scanf_s、strcpy_s，但这些并不是标准C/C++函数。要想继续使用此函数，需要添加 _CRT_SECURE_NO_WARNINGS这个预定义。

在项目 -> 属性 -> C/C++->预处理器 -> 预处理器定中添加 _CRT_SECURE_NO_WARNINGS：

<img src="D:\photos\微信图片_20220112214621.png" style="zoom:80%;" />

------

### 1.3  设置窗口属性

#### (1) 设置图标

打开资源视图，添加本地ICO图标，在res文件夹中添加我们提前准备的图标资源：

<img src="D:\photos\微信图片_20220112215142.png" style="zoom:80%;" />

<img src="D:\photos\微信图片_20220112215238.png" style="zoom:80%;" />

在资源的属性中修改ID(IDI_ICON_WIN)：

<img src="D:\photos\微信图片_20220112215401.png" style="zoom: 80%;" />

在CMainFrame的 OnCreate()中添加如下代码( GCL_HICON仅在x86调试器下可使用)：

```c++
//设置图标，IDI_ICON_WIN为图标资源ID，此为WINAPI函数
SetClassLong(m_hWnd, GCL_HICON, (LONG)AfxGetApp()->LoadIconW(IDI_ICON_WIN));
```

#### (2) 设置窗口大小和居中显示

还是在CMainFrame的OnCreate()中接着写代码：

```c++
//设置窗口的位置和大小：CWnd::MoveWindow
    //0, 0, 起点坐标x和y
    //800, 500, 窗口宽度和高度
    MoveWindow(0, 0, 800, 500);

    //将窗口移动到屏幕中央，CWnd::CenterWindow
    CenterWindow();
```

#### （3) 设置窗口标题

在学生成绩管理系统Doc文档类中的OnNewDocument()函数中添加如下代码：

```c++
//设置窗口标题，CDocument::SetTitle
    SetTitle(TEXT("学生成绩管理系统"));
```

------

## 2 文件处理

### 2.1 文件内容格式

<img src="D:\photos\微信图片_20220112220427.png" style="zoom:80%;" />

#### （1）login.ini文件

记录所有登录信息

#### (2)  messa.ini文件

记录当前登录信息

#### (3) stock.txt文件

 记录学生成绩信息

------

### 2.2  设计文件处理类CInfoFile

#### (1) 添加文件处理类CInfoFile

<img src="C:\Users\20108\AppData\Roaming\Typora\typora-user-images\image-20220112221231102.png" alt="image-20220112221231102" style="zoom:80%;" />

#### （2）头文件(InfoFile.h)的设计

定义三个文件的宏

![image-20220112221413481](C:\Users\20108\AppData\Roaming\Typora\typora-user-images\image-20220112221413481.png)

```c++
#define _F_LOGIN "./login.ini"
#define _F_STOCK "./stock.txt"
#define _F_MESSA "./messa.ini"
```

定义学生结构体

<img src="C:\Users\20108\AppData\Roaming\Typora\typora-user-images\image-20220112221629287.png" alt="image-20220112221629287" style="zoom:80%;" />

```c++
struct msg
{
    string id;        //学生学号
    string name;    //学生姓名
    string sex;        //学生性别
    int score1;
    int score2;
    int score3;      //学生的三门成绩
    int score_sum;    //学生总成绩
};
```

定义登录信息结构体

<img src="C:\Users\20108\AppData\Roaming\Typora\typora-user-images\image-20220112221719014.png" alt="image-20220112221719014" style="zoom:80%;" />

```c++
struct message
{
    string id;        //身份
    string m_user;    //用户名
    string m_pwd;    //密码
};
```

添加对应容器

<img src="C:\Users\20108\AppData\Roaming\Typora\typora-user-images\image-20220112221902232.png" alt="image-20220112221902232" style="zoom:80%;" />

```c++
    list<message> vms; //存储账户密码
    list<msg> ls;    //存储学生信息容器
    int num;            //用来记录学生数目
```

添加对应函数的声明

<img src="C:\Users\20108\AppData\Roaming\Typora\typora-user-images\image-20220112222015849.png" alt="image-20220112222015849" style="zoom:80%;" />

```c++
//注册
    bool Resider(CString& id,CString& name, CString& pwd);

    //匹配登陆信息
    bool ReadLogin(CString &name, CString &pwd);

    //读取登录信息
    message ReadMessage();

    //修改密码
    void WritePwd(string& id, string& user, string& pwd);

    // 读取学生信息
    void ReadDocline();

    //学生信息写入文件
    void WirteDocline();

    //添加学生信息
    void Addline(CString id,CString name, CString sex, int score1, int score2, int score3);

    //清空文档
    void Clear_file();
```

#### (3) 源文件(InfoFile.cpp)的设计

```C++
//注册
bool CInfoFile::Resider(CString& id,CString& name, CString& pwd)
{
    message mes;
    ifstream ifs;
    ifs.open(_F_LOGIN, ios::in);
    if (!ifs.is_open())
    {
        ofstream p_ofs;
        p_ofs.open(_F_LOGIN, ios::out);
        p_ofs.close();
    }
    char buf[1024] = { 0 };
    char* ptr = NULL;
    while (!ifs.eof())
    {
        ifs.getline(buf, sizeof(buf));
        char* sst = strtok_s(buf, " ", &ptr);
        if (sst != NULL)
        {
            mes.id = sst;
        }
        else
        {
            break;
        }
        sst = strtok_s(NULL, " ", &ptr);
        mes.m_user = sst;
        sst = strtok_s(NULL, " ", &ptr);
        mes.m_pwd = sst;
        if ((CString)mes.m_user.c_str() == name)
        {
            return FALSE;
        }
    }
    ofstream ofs;
    ofs.open(_F_LOGIN, ios::out | ios::app);
    std::string STDStr1(CW2A(id.GetString()));
    std::string STDStr2(CW2A(name.GetString()));
    std::string STDStr3(CW2A(pwd.GetString()));//CString 转 string
    ofs << STDStr1 << " " << STDStr2 << " " << STDStr3 << endl;
    ofs.close();
    return TRUE;
}

//匹配登陆信息
bool CInfoFile::ReadLogin(CString &name, CString &pwd)
{
    ifstream ifs; //创建文件输入对象
    ifs.open(_F_LOGIN,ios::in); //打开文件

    char buf[1024] = { 0 };
    char* ptr = NULL;
    while (!ifs.eof())
    {

        ifs.getline(buf, sizeof(buf));
        char* sst = strtok_s(buf, " ", &ptr);
        message mes;
        if (sst != NULL)
        {
            mes.id = sst;//身份
        }
        else
        {
            break;
        }

        sst = strtok_s(NULL, " ", &ptr);
        mes.m_user = sst;
        sst = strtok_s(NULL, " ", &ptr);
        mes.m_pwd = sst;
        vms.push_back(mes);
    }
    ifs.close();
    for (list<message>::iterator it = vms.begin();it != vms.end();it++)
    {
        if (name == (CString)it->m_user.c_str() && pwd == (CString)it->m_pwd.c_str())
        {
            ifs.close();
            ofstream ofs;
            ofs.open(_F_MESSA, ios::out | ios::trunc);
            ofs << it->id << " " << it->m_user << " " << it->m_pwd << endl;
            ofs.close();
            return TRUE;
        }
    }
    ifs.close();
    return FALSE;
}

//读取登录信息
message CInfoFile::ReadMessage()
{
    message mes;
    ifstream ifs;
    ifs.open(_F_MESSA, ios::in);
    char buf[1024] = { 0 };
    char* ptr = NULL;
    ifs.getline(buf, sizeof(buf));
    char* sst = strtok_s(buf," ", &ptr);
    mes.id = sst;
    sst = strtok_s(NULL, " ", &ptr);
    mes.m_user = sst;
    sst = strtok_s(NULL, " ", &ptr);
    mes.m_pwd = sst;
    ifs.close();
    return mes;
}

//修改密码
void CInfoFile::WritePwd(string& id, string& user, string& pwd)
{
    for (list<message>::iterator it = vms.begin(); it != vms.end(); it++)
    {
        if (it->id == id && it->m_user == user)
        {
            vms.erase(it);
            break;
        }
    }
    message mes;
    mes.id = id;
    mes.m_user = user;
    mes.m_pwd = pwd;
    vms.push_back(mes);
    ofstream ofs;     //创建文件输出对象
    ofs.open(_F_LOGIN,ios::out | ios::trunc); //打开文件
    for (list<message>::iterator it = vms.begin(); it != vms.end(); it++)
    {
        ofs << it->id << " ";
        ofs << it->m_user << " ";
        ofs << it->m_pwd << " " << endl;
    }
    ofs.close();    //关闭文件
    ofstream ofs1;
    ofs1.open(_F_MESSA, ios::out | ios::trunc);
    ofs1 << id << " " << user << " " << pwd << endl;
    ofs1.close();
}

//读取学生信息
void CInfoFile::ReadDocline()
{
    ifstream ifs(_F_STOCK, ios::in); //输入方式打开文件
    if (!ifs.is_open())
    {
        ofstream ofs(_F_STOCK, ios::out);
        ofs << "学生学号|学生姓名|性别|第一门成绩|第二门成绩|第三门成绩|总分" << endl; //写入表头
        ofs.close();
        return;
    }
    char ch;
    ifs >> ch;

    if (ifs.eof())
    {
        ofstream ofs(_F_STOCK,ios::out);
        ofs << "学生学号|学生姓名|性别|第一门成绩|第二门成绩|第三门成绩|总分" << endl; //写入表头
        ofs.close();
        num = 0;
        return;
    }
    char buf[1024] = { 0 };
    num = 0;    //初始化学生数目为0
    ls.clear();
    //取出表头
    ifs.getline(buf, sizeof(buf));
    char* ptr = NULL;
    while (!ifs.eof()) //没到文件结尾
    {
        msg tmp;

        ifs.getline(buf, sizeof(buf)); //读取一行
        num++;    //学生数目加一

        //AfxMessageBox(CString(buf));
        char *sst = strtok_s(buf, "|",&ptr); //以“|”切割
        if (sst != NULL)
        {
            tmp.id = sst; //学生学号
        }
        else
        {
            break;
        }

        sst = strtok_s(NULL, "|",&ptr);
        tmp.name = sst;    //学生姓名

        sst = strtok_s(NULL, "|",&ptr);
        tmp.sex = sst;    //学生性别

        sst = strtok_s(NULL, "|", &ptr);
        tmp.score1 = atoi(sst);    //学生三门成绩
        sst = strtok_s(NULL, "|", &ptr);
        tmp.score2 = atoi(sst);    //学生三门成绩
        sst = strtok_s(NULL, "|", &ptr);
        tmp.score3 = atoi(sst);    //学生三门成绩
        sst = strtok_s(NULL, "|", &ptr);
        tmp.score_sum = atoi(sst);    //学生三门成绩总分
        ls.push_back(tmp); //放在链表的后面
    }

    ifs.close(); //关闭文件
}

//学生信息录入文件
void CInfoFile::WirteDocline()
{
    ofstream ofs(_F_STOCK, ios::trunc);//输出方式打开文件
    ofs << "学生学号|学生姓名|性别|第一门成绩|第二门成绩|第三门成绩|总分" << endl; //写入表头

    //    //通过迭代器取出链表内容，写入文件，以“|”分隔，结尾加换行
    for (list<msg>::iterator it = ls.begin(); it != ls.end(); it++)
    {
        ofs << it->id << "|";
        ofs << it->name << "|";
        ofs << it->sex << "|";
        ofs << it->score1 << "|";
        ofs << it->score2 << "|";
        ofs << it->score3 << "|";
        ofs << it->score_sum << endl;
    }

    ofs.close();//关闭文件
}

//添加学生信息
//id:学生学号, name:学生姓名, sex:学生性别, arr[3]:学生三门科目成绩
void CInfoFile::Addline(CString id, CString name, CString sex, int score1, int score2, int score3)
{
    msg tmp;

        //学生信息有效
        if (!id.IsEmpty() || !name.IsEmpty() || !sex.IsEmpty())
        {
            CStringA str1;
            str1 = id;
            tmp.id = str1.GetBuffer();    //学号CStringA str2;
            CStringA str2;
            str2 = name;    //CString转CStirngA
            tmp.name = str2.GetBuffer(); //CStirngA转char *，商品名称
            CStringA str3;
            str3 = sex;    //CString转CStirngA
            tmp.sex = str3.GetBuffer();
            tmp.score1 = score1;
            tmp.score2 = score2;
            tmp.score3 = score3;
            tmp.score_sum = score1 + score2 + score3;
            ls.push_back(tmp);    //放在链表的后面
        }
}

void CInfoFile::Clear_file()
{
    this->ls.clear();
    ofstream ofs;
    ofs.open(_F_STOCK, ios::trunc);
    ofs.close();
}
```

------

## 3 登录对话框

### 3.1 ui设计

#### (1)添加对话框资源(ID修改为DIALOG_LOGIN)，添加所需控件：

<img src="学生成绩管理系统.assets/image-20220113103755690.png" alt="image-20220113103755690" style="zoom:80%;" />

#### (2)选中对话框 -> 右击 -> 添加类 -> 类名：CLoginDlg

<img src="学生成绩管理系统.assets/clip_image002.jpg" alt="2016-07-10_011454_副本" style="zoom:80%;" />

<img src="学生成绩管理系统.assets/image-20220113103935200.png" alt="image-20220113103935200" style="zoom:80%;" />

#### (3)根据需求，控件关联所需变量

用户名编辑区关联CString m_user,密码登陆框关联CString m_pwd。

//均以值方式创建

<img src="学生成绩管理系统.assets/image-20220113104109683.png" alt="image-20220113104109683" style="zoom:80%;" />

<img src="学生成绩管理系统.assets/image-20220113104144218.png" alt="image-20220113104144218" style="zoom:80%;" />

<img src="学生成绩管理系统.assets/image-20220113104202166.png" alt="image-20220113104202166" style="zoom:80%;" />

------

### 3.2 功能实现

#### (1)登陆窗口的创建

在应用程序类学生成绩管理系统App的InitInstance() 里面的APP 创建之前创建登陆对话框：

<img src="学生成绩管理系统.assets/image-20220113104526103.png" alt="image-20220113104526103" style="zoom:80%;" />

```c++
    CLoginDlg dlg;    //创建登陆对话框，需要头文件#include "LoginDlg.h"
    dlg.DoModal();    //以模态方式运行
```

#### (2)登录按钮功能实现

单击击按钮控件，在属性-》控件事件中添加点击按钮函数

<img src="学生成绩管理系统.assets/image-20220113104736749.png" alt="image-20220113104736749" style="zoom:80%;" />

```c++
void CLoginDlg::OnBnClickedButton1()
{
    UpdateData(TRUE); //更新控件的数据到对应的变量

    CInfoFile file; //创建操作文件类对象，需要头文件#include "InfoFile.h" 

    //读取配置文件，获取用户名密码，参数为引用传递

    if (m_user.IsEmpty() || m_pwd.IsEmpty())
    {
        MessageBox(_T("输入信息不能为空"));
        m_user.Empty();
        m_pwd.Empty();
        UpdateData(FALSE);
    }
    else
    {
        if (file.ReadLogin(m_user,m_pwd))
        {
            MessageBox(_T("登录成功"));
            CDialogEx::OnOK();
        }
        else
        {
            MessageBox(_T("登录失败"));
            m_pwd.Empty();
            UpdateData(FALSE);
        }
    }
}
```

#### (3)右上角关闭按钮功能实现

选中对话框模板 -> 右击 -> 属性 -> 消息 -> WM_CLOSE

<img src="学生成绩管理系统.assets/clip_image002-16420422286021.jpg" alt="2016-07-10_012030_副本" style="zoom:80%;" />

```C++
void CLoginDlg::OnClose()
{
    // TODO: 在此添加消息处理程序代码和/或调用默认值
    exit(0);    //结束整个程序


    CDialogEx::OnClose();
}
```

#### (4)编辑区回车键关闭对话框问题解决

重写CLoginDlg类中的OnOk（）函数

<img src="学生成绩管理系统.assets/image-20220113105350577.png" alt="image-20220113105350577" style="zoom:80%;" />

<img src="学生成绩管理系统.assets/clip_image002-16420424868662.jpg" alt="2016-07-10_015351_副本" style="zoom:80%;" />

------

## 4 注册对话框

### 4.1 ui设计

#### (1)添加对话框资源(ID修改为DIALOG_RESIDER)，添加所需控件：

<img src="学生成绩管理系统.assets/image-20220113105821649.png" alt="image-20220113105821649" style="zoom:80%;" />

#### (2)选中对话框 -> 右击 -> 添加类 -> 类名 CResiderDlg：

<img src="学生成绩管理系统.assets/image-20220113110008836.png" alt="image-20220113110008836" style="zoom:80%;" />

#### (3)根据需求，控件关联所需变量

<img src="学生成绩管理系统.assets/image-20220113110119652.png" alt="image-20220113110119652" style="zoom:80%;" />

<img src="学生成绩管理系统.assets/image-20220113110149809.png" alt="image-20220113110149809" style="zoom:80%;" />

<img src="学生成绩管理系统.assets/image-20220113110216879.png" alt="image-20220113110216879" style="zoom:80%;" />

<img src="学生成绩管理系统.assets/image-20220113110225692.png" alt="image-20220113110225692" style="zoom:80%;" />

身份下拉框： m_combox 用户名编辑框： m_user 密码编辑框: m_pwd

------

### 4.2 功能实现

#### (1)重写CResiderDlg类中的OnInitDialog初始化函数

<img src="学生成绩管理系统.assets/image-20220113110438077.png" alt="image-20220113110438077" style="zoom:80%;" />

```c++
BOOL CResiderDlg::OnInitDialog()
{
    CDialogEx::OnInitDialog();

    // TODO:  在此添加额外的初始化
    m_combox.AddString(_T("学生"));
    m_combox.AddString(_T("老师"));
    m_combox.SetCurSel(0);
    return TRUE;  // return TRUE unless you set the focus to a control
                  // 异常: OCX 属性页应返回 FALSE
}
```

#### （2）确认按钮功能实现

```c++
void CResiderDlg::OnBnClickedButton1()
{
    // TODO: 在此添加控件通知处理程序代码
    UpdateData(TRUE);
    if (m_user.IsEmpty() || m_pwd.IsEmpty())
    {
        MessageBox(_T("信息不能为空"));
        return;
    }
    CString str;
    int temp = m_combox.GetCurSel();
    m_combox.GetLBText(temp, str);
    CInfoFile file;
    if (file.Resider(str, m_user, m_pwd))
    {
        MessageBox(_T("注册成功"));
        OnOK();
    }
    else
    {
        MessageBox(_T("注册失败,用户名重复"));
        m_user.Empty();
        m_pwd.Empty();
        UpdateData(FALSE);
        return;
    }
}
```

#### (3)取消按钮功能实现

```c++
void CResiderDlg::OnBnClickedButton2()
{
    // TODO: 在此添加控件通知处理程序代码
    m_user.Empty();
    m_pwd.Empty();
    UpdateData(FALSE);
    OnOK();
}
```

#### (4)弹出注册界面按钮设置

在登录对话框中的注册按钮添加单击控件事件

```c++
void CLoginDlg::OnBnClickedButton2()
{
    // TODO: 在此添加控件通知处理程序代码
    CResiderDlg dlg;
    dlg.DoModal();
}
```

------

## 5  静态拆分窗口

### 5.1 自定义MFC视图类

自定义两个类：CSelectView和CDispalyView(它的基类必须是视图类)。

CSelectView继承于CTreeView，CDispalyView继承于CFormView。

<img src="学生成绩管理系统.assets/image-20220114214013173.png" alt="image-20220114214013173" style="zoom:80%;" />

<img src="学生成绩管理系统.assets/image-20220114214053656.png" alt="image-20220114214053656" style="zoom:80%;" />

<img src="学生成绩管理系统.assets/image-20220114214138317.png" alt="image-20220114214138317" style="zoom:80%;" />

### 5.2 通过CSplitterWnd类拆分窗口

#### (1)CMainFrame类中，声明CSplitterWnd类型的对象：

<img src="学生成绩管理系统.assets/image-20220114220724653.png" alt="image-20220114220724653" style="zoom:80%;" />

```c++
private:
    CSplitterWnd m_spliter; // 切分窗口类对象
```

#### (2)重写框架类CMainFrame的OnCreateClient函数

<img src="学生成绩管理系统.assets/image-20220114220900577.png" alt="image-20220114220900577" style="zoom:80%;" />

把OnCreateClient()函数的返回值改为Return TRUE:

<img src="学生成绩管理系统.assets/clip_image002-16421694090731.jpg" alt="2016-07-10_083754_副本" style="zoom:80%;" />

静态拆分实现代码如下：

<img src="学生成绩管理系统.assets/image-20220114221335896.png" alt="image-20220114221335896" style="zoom:80%;" />

```c++
BOOL CMainFrame::OnCreateClient(LPCREATESTRUCT lpcs, CCreateContext* pContext)
{
    // TODO: 在此添加专用代码和/或调用基类
    // 静态拆分窗口，1行2列，CSplitterWnd::CreateStatic
    m_spliter.CreateStatic(this, 1, 2);

    // 创建视图：CSplitterWnd::CreateView
    //0, 0 ： 放在第0行第0列的位置
    //RUNTIME_CLASS(CSelectView) ：需要头文件#include "SelectView.h"， CSelectView在SelectView.h中声明
    // CSize(250, 500)：指定视图宽度和高度
    //pContext ： 为OnCreateClient()最后一个形参
    m_spliter.CreateView(0, 0, RUNTIME_CLASS(CSelectView), CSize(200, 500), pContext);

    //0, 1： 放在第0行第1列的位置
    //CDispalyView，需要头文件#include "DispalyView.h"
    m_spliter.CreateView(0, 1, RUNTIME_CLASS(CDispalyView), CSize(600, 500), pContext);

    //return CFrameWndEx::OnCreateClient(lpcs, pContext);
    return TRUE;
}
```

------

## 6  树视图功能实现

### 5.1  添加功能节点

#### (1)加载图标资源

<img src="学生成绩管理系统.assets/clip_image002-16421700726662.jpg" alt="2016-07-10_132141_副本" style="zoom:80%;" />

图标资源ID改为：IDI_ICON_RE

<img src="学生成绩管理系统.assets/clip_image002-16421701209133.jpg" alt="2016-07-10_132113_副本" style="zoom:80%;" />

#### (2)CSelectView类中声明相应变量：

```c++
    CTreeCtrl *m_treeCtrl;    //树控件
    CImageList m_imageList;    //图标列表
```

#### (3)重写CSelectView的OnInitUpdate函数

<img src="学生成绩管理系统.assets/image-20220114222457698.png" alt="image-20220114222457698" style="zoom:80%;" />

#### (4)在CSelectView的OnInitUpdate函数中，完成初始化功能

```c++
void CSelectView::OnInitialUpdate()
{
    CTreeView::OnInitialUpdate();

    // TODO: 在此添加专用代码和/或调用基类
    //图标资源的加载 CWinApp::LoadIcon
//IDI_ICON_RE为图标资源ID
    HICON icon = AfxGetApp()->LoadIconW(IDI_ICON_RE);

    //图片列表的创建 CImageList::Create
    //30, 30：指定图标的宽度和高度
    //ILC_COLOR32：图标格式
    //1, 1：有多少图标就写多少
    m_imageList.Create(30, 30, ILC_COLOR32, 1, 1);

    //图片列表追加图标 CImageList::Add
    m_imageList.Add(icon);

    //获取数视图中的树控件 CTreeView::GetTreeCtrl
    m_treeCtrl = &GetTreeCtrl();

    //数控件设置图片列表 CTreeCtrl::SetImageList
    m_treeCtrl->SetImageList(&m_imageList, TVSIL_NORMAL);

    //树控件设置节点 CTreeCtrl::InsertItem
    m_treeCtrl->InsertItem(TEXT("个人信息显示"), 0, 0, NULL);
    m_treeCtrl->InsertItem(TEXT("录入学生信息"), 0, 0, NULL);
    m_treeCtrl->InsertItem(TEXT("显示学生信息"), 0, 0, NULL);
    m_treeCtrl->InsertItem(TEXT("排序学生信息"), 0, 0, NULL);
    m_treeCtrl->InsertItem(TEXT("修改学生信息"), 0, 0, NULL);
    m_treeCtrl->InsertItem(TEXT("查询学生信息"), 0, 0, NULL);
    m_treeCtrl->InsertItem(TEXT("删除学生信息"), 0, 0, NULL);
    m_treeCtrl->InsertItem(TEXT("清空学生信息"), 0, 0, NULL);
}
```

------

### 5.2 功能节点相应消息处理

<img src="学生成绩管理系统.assets/image-20220114222654527.png" alt="image-20220114222654527" style="zoom:80%;" />

在上面函数，实现获取当前节点选中内容：

```c++
void CSelectView::OnTvnSelchanged(NMHDR* pNMHDR, LRESULT* pResult)
{
    LPNMTREEVIEW pNMTreeView = reinterpret_cast<LPNMTREEVIEW>(pNMHDR);
    // TODO: 在此添加控件通知处理程序代码
    *pResult = 0;
    //获取当前节点选中项目 CTreeCtrl::GetSelectedItem
    HTREEITEM item = m_treeCtrl->GetSelectedItem();

    //获取选中项的文本内容 CTreeCtrl::GetItemText
    CString str = m_treeCtrl->GetItemText(item);
    //MessageBox(str);

    if (str == TEXT("个人信息显示"))
    {
        //需要包含框架类头文件#include "MainFrm.h" 
    //CWnd::PostMessage 将一个消息放入窗口的消息队列
    //AfxGetMainWnd()：框架窗口对象的指针
    //AfxGetMainWnd()->GetSafeHwnd()：获取返回窗口的句柄，CWnd::GetSafeHwnd
    //NM_A：发送自定义消息
    //(WPARAM)NM_A：指定了附加的消息信息
    //(LPARAM)0：指定了附加的消息信息，此参数这里没有意义
        ::PostMessage(AfxGetMainWnd()->GetSafeHwnd(), NM_A, (WPARAM)NM_A, (LPARAM)0);

    }
    else if (str == TEXT("录入学生信息"))
    {
        ::PostMessage(AfxGetMainWnd()->GetSafeHwnd(), NM_B, (WPARAM)NM_B, (LPARAM)0);

    }
    else if (str == TEXT("显示学生信息"))
    {
        ::PostMessage(AfxGetMainWnd()->GetSafeHwnd(), NM_C, (WPARAM)NM_C, (LPARAM)0);

    }
    else if (str == TEXT("排序学生信息"))
    {
        ::PostMessage(AfxGetMainWnd()->GetSafeHwnd(), NM_D, (WPARAM)NM_D, (LPARAM)0);

    }
    else if (str == TEXT("修改学生信息"))
    {
        ::PostMessage(AfxGetMainWnd()->GetSafeHwnd(), NM_E, (WPARAM)NM_E, (LPARAM)0);

    }
    else if (str == TEXT("查询学生信息"))
    {
        ::PostMessage(AfxGetMainWnd()->GetSafeHwnd(), NM_F, (WPARAM)NM_F, (LPARAM)0);

    }
    else if (str == TEXT("删除学生信息"))
    {
        ::PostMessage(AfxGetMainWnd()->GetSafeHwnd(), NM_G, (WPARAM)NM_G, (LPARAM)0);

    }
    else if (str == TEXT("清空学生信息"))
    {
        ::PostMessage(AfxGetMainWnd()->GetSafeHwnd(), NM_H, (WPARAM)NM_H, (LPARAM)0);

    }
}
```

------

## 7  个人信息管理窗口

### 7.1ui设计

#### (1) 添加对话框资源(ID修改为DIALOG_USER)，添加所需控件：

<img src="学生成绩管理系统.assets/image-20220114223259588.png" alt="image-20220114223259588" style="zoom:80%;" />

在窗口属性中，Border改为None，Style改为Child：

<img src="学生成绩管理系统.assets/image-20220114223401828.png" alt="image-20220114223401828" style="zoom:80%;" />

<img src="学生成绩管理系统.assets/image-20220114223419246.png" alt="image-20220114223419246" style="zoom:80%;" />

修改密码的两个编辑框属性改成密码True

<img src="学生成绩管理系统.assets/image-20220114223512861.png" alt="image-20220114223512861" style="zoom:80%;" />

#### (2)选中对话框 -> 右击 -> 添加类 -> 类名：CUserDlg，基类选择CFormView

<img src="学生成绩管理系统.assets/image-20220114223915891.png" alt="image-20220114223915891" style="zoom:80%;" />

#### (3)根据需求，控件关联所需变量

<img src="学生成绩管理系统.assets/image-20220114224019621.png" alt="image-20220114224019621" style="zoom:80%;" />

身份: m_user 用户名: m_name 新密码: m_newPwd 确认密码: m_sure_Pwd

### 7.2 功能实现

#### (1)在对话框类中，重写 OnInitDialog 函数，进行初始化。

```c++
void CUserDlg::OnInitialUpdate()
{
    CFormView::OnInitialUpdate();

    // TODO: 在此添加专用代码和/或调用基类
    CInfoFile file;    //需要头文件#include "InfoFile.h"
    m_user = (CString)file.ReadMessage().id.c_str();
    m_name = (CString)file.ReadMessage().m_user.c_str();
    UpdateData(FALSE); //把数据更新到控件上

}
```

#### (2)确认按钮功能实现

```c++
void CUserDlg::OnBnClickedButton1()//修改密码
{
    // TODO: 在此添加控件通知处理程序代码
    UpdateData(TRUE);//更新控件内容到对应的变量中

    if (m_newPwd.IsEmpty() || m_surePwd.IsEmpty())
    {
        MessageBox(TEXT("输入密码不能为空"));
        //输入框内容清空
        m_surePwd.Empty();
        m_newPwd.Empty();
        UpdateData(FALSE); //把数据更新到控件上
        return;
    }

    if (m_newPwd != m_surePwd)
    {
        MessageBox(TEXT("输入密码和确定密码不相等"));
        //输入框内容清空
        m_surePwd.Empty();
        m_newPwd.Empty();
        UpdateData(FALSE); //把数据更新到控件上
        return;
    }

    CInfoFile file;    //需要头文件#include "InfoFile.h"

    if (m_surePwd == (CString)file.ReadMessage().m_pwd.c_str())
    {
        MessageBox(TEXT("输入密码和旧密码相等"));
        //输入框内容清空
        m_surePwd.Empty();
        m_newPwd.Empty();
        UpdateData(FALSE); //把数据更新到控件上
        return;
    }
    string m_user = file.ReadMessage().id;
    string m_name = file.ReadMessage().m_user;
    std::string STDStr(CW2A(m_newPwd.GetString()));//CString 转 string
    string m_pwd = STDStr;
    file.WritePwd(m_user,m_name,m_pwd); //修改密码
    MessageBox(TEXT("密码修改成功"));
    //输入框内容清空
    m_surePwd.Empty();
    m_newPwd.Empty();
    UpdateData(FALSE); //把数据更新到控件上
}
```

#### (3)取消按钮功能实现

```c++
void CUserDlg::OnBnClickedButton2()
{
    // TODO: 在此添加控件通知处理程序代码
    //输入框内容清空
    m_surePwd.Empty();
    m_newPwd.Empty();
    UpdateData(FALSE); //把数据更新到控件上

}
```

------

## 8  界面挂载

### 8.1  自定义信息发送

#### （1)在CMainFrame 框架类中，添加自定义消息宏

<img src="学生成绩管理系统.assets/image-20220115092931159.png" alt="image-20220115092931159" style="zoom:80%;" />

```c++
//WM_USER 是用户自定义消息的一个起始值
//WM_USER+100是为了区分系统消息和用户消息，避免冲突
#define NM_A    (WM_USER + 100)
#define NM_B    (WM_USER + 101)
#define NM_C    (WM_USER + 102)
#define NM_D    (WM_USER + 103)
#define NM_E    (WM_USER + 104)
#define NM_F    (WM_USER + 105)
#define NM_G    (WM_USER + 106)
#define NM_H    (WM_USER + 107)
```

#### （2)在CMainFrame框架类中声明自定义消息处理函数OnMyChange：

<img src="学生成绩管理系统.assets/image-20220115093030185.png" alt="image-20220115093030185" style="zoom:80%;" />

```c++
afx_msg LRESULT OnMyChange(WPARAM wParam, LPARAM lParam);
```

#### （3)对应的.cpp定义其函数

```c++
LRESULT CMainFrame::OnMyChange(WPARAM wParam, LPARAM lParam)
{

}
```

#### （4）在CMainFrame框架类BEGIN_MESSAGE_MAP和END_MESSAGE_MAP之间添加自定义消息入口，与自定义消息处理函数绑定

<img src="学生成绩管理系统.assets/image-20220115093337880.png" alt="image-20220115093337880" style="zoom:80%;" />

```c++
    //ON_MESSAGE响应的是自定义消息
    //产生NM_X消息，自动调用OnMyChange函数
    ON_MESSAGE(NM_A, OnMyChange)
    ON_MESSAGE(NM_B, OnMyChange)
    ON_MESSAGE(NM_C, OnMyChange)
    ON_MESSAGE(NM_D, OnMyChange)
    ON_MESSAGE(NM_E, OnMyChange)
    ON_MESSAGE(NM_F, OnMyChange)
    ON_MESSAGE(NM_G, OnMyChange)
    ON_MESSAGE(NM_H, OnMyChange)
```

#### （5)发送自定义信号

在CSelectView的OnTvnSelchanged函数中，发送自定义信号：

```c++
void CSelectView::OnTvnSelchanged(NMHDR* pNMHDR, LRESULT* pResult)
{
    LPNMTREEVIEW pNMTreeView = reinterpret_cast<LPNMTREEVIEW>(pNMHDR);
    // TODO: 在此添加控件通知处理程序代码
    *pResult = 0;
    //获取当前节点选中项目 CTreeCtrl::GetSelectedItem
    HTREEITEM item = m_treeCtrl->GetSelectedItem();

    //获取选中项的文本内容 CTreeCtrl::GetItemText
    CString str = m_treeCtrl->GetItemText(item);
    //MessageBox(str);

    if (str == TEXT("个人信息显示"))
    {
        //需要包含框架类头文件#include "MainFrm.h" 
    //CWnd::PostMessage 将一个消息放入窗口的消息队列
    //AfxGetMainWnd()：框架窗口对象的指针
    //AfxGetMainWnd()->GetSafeHwnd()：获取返回窗口的句柄，CWnd::GetSafeHwnd
    //NM_A：发送自定义消息
    //(WPARAM)NM_A：指定了附加的消息信息
    //(LPARAM)0：指定了附加的消息信息，此参数这里没有意义
        ::PostMessage(AfxGetMainWnd()->GetSafeHwnd(), NM_A, (WPARAM)NM_A, (LPARAM)0);

    }
    else if (str == TEXT("录入学生信息"))
    {
        ::PostMessage(AfxGetMainWnd()->GetSafeHwnd(), NM_B, (WPARAM)NM_B, (LPARAM)0);

    }
    else if (str == TEXT("显示学生信息"))
    {
        ::PostMessage(AfxGetMainWnd()->GetSafeHwnd(), NM_C, (WPARAM)NM_C, (LPARAM)0);

    }
    else if (str == TEXT("排序学生信息"))
    {
        ::PostMessage(AfxGetMainWnd()->GetSafeHwnd(), NM_D, (WPARAM)NM_D, (LPARAM)0);

    }
    else if (str == TEXT("修改学生信息"))
    {
        ::PostMessage(AfxGetMainWnd()->GetSafeHwnd(), NM_E, (WPARAM)NM_E, (LPARAM)0);

    }
    else if (str == TEXT("查询学生信息"))
    {
        ::PostMessage(AfxGetMainWnd()->GetSafeHwnd(), NM_F, (WPARAM)NM_F, (LPARAM)0);

    }
    else if (str == TEXT("删除学生信息"))
    {
        ::PostMessage(AfxGetMainWnd()->GetSafeHwnd(), NM_G, (WPARAM)NM_G, (LPARAM)0);

    }
    else if (str == TEXT("清空学生信息"))
    {
        ::PostMessage(AfxGetMainWnd()->GetSafeHwnd(), NM_H, (WPARAM)NM_H, (LPARAM)0);

    }
}
```

------

### 8.2 自定义信息处理

在CMainFrame框架类OnMyChange函数中处理相应消息

```c++
LRESULT CMainFrame::OnMyChange(WPARAM wParam, LPARAM lParam)
{
    CCreateContext   Context;
    if(wParam == NM_A)
    {

    }
    else if(wParam == NM_B)
    {

    } 
    else if (wParam == NM_C)
    {

    }
    else if (wParam == NM_D)
    {

    }
    else if (wParam == NM_E)
    {

    }
    else if (wParam == NM_F)
    {

    }
    else if (wParam == NM_G)
    {

    }
    else if (wParam == NM_H)
    {

    }
    return 0;
}
```

------

### 8.3 界面挂载

如果是NM_A信号，则挂载CUserDlg窗口，后面界面的挂载以此类推。

```c++
LRESULT CMainFrame::OnMyChange(WPARAM wParam, LPARAM lParam)
{
    CCreateContext   Context;
    if(wParam == NM_A)
    {
        //CUserDlg类需要包含头文件#include "UserDlg.h"
        Context.m_pNewViewClass = RUNTIME_CLASS(CUserDlg);
        Context.m_pCurrentFrame = this;
        Context.m_pLastView = (CFormView*)m_spliter.GetPane(0, 1);
        m_spliter.DeleteView(0, 1);
        m_spliter.CreateView(0, 1, RUNTIME_CLASS(CUserDlg), CSize(600, 500), &Context);
        CUserDlg* pNewView = (CUserDlg*)m_spliter.GetPane(0, 1);
        m_spliter.RecalcLayout();
        pNewView->OnInitialUpdate();
        m_spliter.SetActivePane(0, 1);
    }
    else if(wParam == NM_B)
    {

    } 
    else if (wParam == NM_C)
    {

    }
    else if (wParam == NM_D)
    {

    }
    else if (wParam == NM_E)
    {

    }
    else if (wParam == NM_F)
    {

    }
    else if (wParam == NM_G)
    {

    }
    else if (wParam == NM_H)
    {

    }
    return 0;
}
```

------

## 9 录入学生信息窗口实现

### 9.1 ui设计

#### (1) 添加对话框资源(ID修改为DIALOG_ADD)，添加所需控件：

<img src="学生成绩管理系统.assets/image-20220115095945389.png" alt="image-20220115095945389" style="zoom:80%;" />

在窗口属性中，Border改为None，Style改为Child：

<img src="学生成绩管理系统.assets/image-20220114223401828.png" alt="image-20220114223401828" style="zoom:80%;" />

<img src="学生成绩管理系统.assets/image-20220114223419246.png" alt="image-20220114223419246" style="zoom:80%;" />

#### (2)选中对话框 -> 右击 -> 添加类 -> 类名：CAddDlg，基类选择CFormView

#### (3)根据需求，控件关联所需变量

<img src="学生成绩管理系统.assets/image-20220115100130948.png" alt="image-20220115100130948" style="zoom:80%;" />

身份: index 姓名: name 性别: sex 第一门成绩: score1 第二门成绩: score2 第三门成绩: score3

<img src="学生成绩管理系统.assets/image-20220115121136612.png" alt="image-20220115121136612" style="zoom:80%;" />

<img src="学生成绩管理系统.assets/image-20220115121156379.png" alt="image-20220115121156379" style="zoom:80%;" />

<img src="学生成绩管理系统.assets/image-20220115121213106.png" alt="image-20220115121213106" style="zoom:80%;" />

<img src="学生成绩管理系统.assets/image-20220115121229589.png" alt="image-20220115121229589" style="zoom:80%;" />

------

#### 9.2 功能实现

#### (1)添加按钮功能实现

```c++
void CAddDlg::OnBnClickedButton1()//确认按钮设置
{
    // TODO: 在此添加控件通知处理程序代码
    UpdateData(TRUE); //获取控件内容

    if (index.IsEmpty() || name.IsEmpty()|| sex.IsEmpty())
    {
        MessageBox(TEXT("输入信息有误"));
        return;
    }
    CInfoFile file;
    file.ReadDocline(); //读取学生信息
    file.Addline(index, name, sex,score1,score2,score3); //添加学生信息
    file.WirteDocline(); //写文件
    file.ls.clear(); //清空list的内容
    MessageBox(_T("添加成功"));
    index.Empty();
    name.Empty();
    sex.Empty();
    score1 = 0;
    score2 = 0;
    score3 = 0;
    UpdateData(FALSE);
}
```

#### (2)取消按钮功能实现

```c++
void CAddDlg::OnBnClickedButton2()//取消按钮设置
{
    // TODO: 在此添加控件通知处理程序代码
    index.Empty();
    name.Empty();
    sex.Empty();
    score1 = 0;
    score2 = 0;
    score3 = 0;
    UpdateData(FALSE);
}
```

------

## 10 显示学生信息窗口实现

### 10.1 ui设计

#### (1)添加对话框资源(ID修改为DIALOG_INFO)，添加所需控件：

<img src="学生成绩管理系统.assets/image-20220115120839021.png" alt="image-20220115120839021" style="zoom:80%;" />

在窗口属性中，Border改为None，Style改为Child：

<img src="学生成绩管理系统.assets/image-20220114223401828.png" alt="image-20220114223401828" style="zoom:80%;" />

<img src="学生成绩管理系统.assets/image-20220114223419246.png" alt="image-20220114223419246" style="zoom:80%;" />

#### (2)选中对话框 -> 右击 -> 添加类 -> 类名：CInfoDlg，基类选择CFormView

#### (3)根据需求，控件关联所需变量

<img src="学生成绩管理系统.assets/image-20220115121053100.png" alt="image-20220115121053100" style="zoom:80%;" />

<img src="D:\program\C++\项目\学生成绩管理系统1.0\学生成绩管理系统.assets\image-20220116115809325.png" alt="image-20220116115809325" style="zoom:80%;" />

列表控件:m_list view处设为报表模式

### 10.2 功能实现

重写CInfoDlg类中的OnInitUpdate()函数

```c++
void CInfoDlg::OnInitialUpdate()
{
    CFormView::OnInitialUpdate();

    // TODO: 在此添加专用代码和/或调用基类
    // 设置扩展风格
    //LVS_EX_FULLROWSELECT选中整行，LVS_EX_GRIDLINES网格
    m_list.SetExtendedStyle(m_list.GetExtendedStyle() | LVS_EX_FULLROWSELECT | LVS_EX_GRIDLINES);

    // 初始化表头
    CString field[] = { _T("学生学号"),_T("学生姓名"), _T("性别"), _T("第一门成绩"),_T("第二门成绩"), _T("第三门成绩"), _T("总分")};
    for (int i = 0; i < sizeof(field) / sizeof(field[0]); ++i)
    {
        m_list.InsertColumn(i, field[i], LVCFMT_CENTER, 90);
    }

    //需要包含#include "InfoFile.h"
    CInfoFile file;
    file.ReadDocline(); //读取商品信息

    //添加数据
    int i = 0;
    CString str;
    for (list<msg>::iterator it = file.ls.begin(); it != file.ls.end(); it++)
    {

        m_list.InsertItem(i, (CString)it->id.c_str());
        int column = 1;
        m_list.SetItemText(i, column++, (CString)it->name.c_str());
        m_list.SetItemText(i, column++, (CString)it->sex.c_str());
        str.Format(_T("%d"), it->score1);
        m_list.SetItemText(i, column++, str);
        str.Format(_T("%d"), it->score2);
        m_list.SetItemText(i, column++, str);
        str.Format(_T("%d"), it->score3);
        m_list.SetItemText(i, column++, str);
        str.Format(_T("%d"), it->score_sum);
        m_list.SetItemText(i, column++, str);
        i++;
    }

}
```

------



## 11 排序学生信息窗口实现

### 11.1 ui设计

#### (1)添加对话框资源(ID修改为DIALOG_SORT)，添加所需控件：

<img src="D:\program\C++\项目\学生成绩管理系统.assets\image-20220115210226140.png" alt="image-20220115210226140" style="zoom:80%;" />

在窗口属性中，Border改为None，Style改为Child：

<img src="学生成绩管理系统.assets/image-20220114223401828.png" alt="image-20220114223401828" style="zoom:80%;" />

<img src="学生成绩管理系统.assets/image-20220114223419246.png" alt="image-20220114223419246" style="zoom:80%;" />

#### (2)选中对话框 -> 右击 -> 添加类 -> 类名：CDlgSort，基类选择CFormView

------



### 11.2 功能实现

#### (1) 重载sort规则(需要包含头文件#include<algorithm>,<vector>,<)

```c++
//重载sort规则
bool Compare1(const msg& msg1, const msg& msg2)//学号
{
	return atoi(msg1.id.c_str()) < atoi(msg2.id.c_str());
}
bool Compare2(const msg& msg1, const msg& msg2)//成绩
{
	return msg1.score_sum < msg2.score_sum;
}
```



#### (2)按成绩排序按钮实现

```c++
void CDlgSort::OnBnClickedButton1()//按成绩排序
{
	// TODO: 在此添加控件通知处理程序代码
	CInfoFile file;
	file.ReadDocline();
	vector<msg> vc;
	for (list<msg>::iterator it = file.ls.begin();it != file.ls.end();it++)
	{
		vc.push_back(*it);
	}
	sort(vc.begin(), vc.end(), Compare2);
	file.ls.clear();
	for (vector<msg>::iterator it = vc.begin();it != vc.end();it++)
	{
		file.ls.push_back(*it);
	}
	file.WirteDocline();
	MessageBox(_T("排序成功"));
}
```

#### (3)按学号排序按钮实现

```c++
void CDlgSort::OnBnClickedButton3()//按学号排序
{
	// TODO: 在此添加控件通知处理程序代码
	CInfoFile file;
	file.ReadDocline();
	vector<msg> vc;
	for (list<msg>::iterator it = file.ls.begin(); it != file.ls.end(); it++)
	{
		vc.push_back(*it);
	}
	sort(vc.begin(), vc.end(), Compare1);
	file.ls.clear();
	for (vector<msg>::iterator it = vc.begin(); it != vc.end(); it++)
	{
		file.ls.push_back(*it);
	}
	file.WirteDocline();
	MessageBox(_T("排序成功"));
}
```

------



## 12  修改学生信息按钮实现

### 12.1 ui设计

#### (1)添加对话框资源(ID修改为DIALOG_MOD)，添加所需控件：

<img src="D:\program\C++\项目\学生成绩管理系统.assets\image-20220115211808825.png" alt="image-20220115211808825" style="zoom:80%;" />

在窗口属性中，Border改为None，Style改为Child：

<img src="学生成绩管理系统.assets/image-20220114223401828.png" alt="image-20220114223401828" style="zoom:80%;" />

<img src="学生成绩管理系统.assets/image-20220114223419246.png" alt="image-20220114223419246" style="zoom:80%;" />

#### (2)选中对话框 -> 右击 -> 添加类 -> 类名：CModDlg，基类选择CFormView

#### (3)根据需求，控件关联所需变量:

<img src="D:\program\C++\项目\学生成绩管理系统.assets\image-20220115212113901.png" alt="image-20220115212113901" style="zoom:80%;" />

<img src="D:\program\C++\项目\学生成绩管理系统.assets\image-20220115212128593.png" alt="image-20220115212128593" style="zoom:80%;" />

------



### 12.2 功能实现

#### (1)重写CModDlg的OnInitUpdate()函数，完成初始化功能

```c++
void CModDlg::OnInitialUpdate()
{
	CFormView::OnInitialUpdate();

	// TODO: 在此添加专用代码和/或调用基类
	//读取文件，获取学生信息，给组合框添加字符串
	//需要包含#include "InfoFile.h"
	CInfoFile file;
	file.ReadDocline(); //读取学生信息
	string str;
	for (list<msg>::iterator it = file.ls.begin(); it != file.ls.end(); it++)
	{
		str = it->id;
		str += " ";
		str += it->name;
		str += " ";
		str += it->sex;
		str += " ";
		str += to_string(it->score1);
		str += " ";
		str += to_string(it->score2);
		str += " ";
		str += to_string(it->score3);
		str += " ";
		str += to_string(it->score_sum);
		str += " ";
		m_combo.AddString((CString)str.c_str());
	}
	//将第一个学生信息设为默认选中项
	m_combo.SetCurSel(0);
}
```

#### (2)下拉框函数设置

```c++
void CModDlg::OnCbnSelchangeCombo1()
{
	// TODO: 在此添加控件通知处理程序代码
	UpdateData(TRUE);
	CString text;
	int temp = m_combo.GetCurSel();
	m_combo.GetLBText(temp, text);
	std::string STDStr(CW2A(text.GetString()));
	char buf[1024] = { 0 };
	for (int i = 0; i < STDStr.size(); i++)
	{
		buf[i] = STDStr[i];
	}
	msg tmp;
	char* ptr = NULL;
	char* sst = strtok_s(buf, " ", &ptr); //以“ ”切割
	tmp.id = sst; //学生学号

	sst = strtok_s(NULL, " ", &ptr);
	tmp.name = sst;	//学生姓名

	sst = strtok_s(NULL, " ", &ptr);
	tmp.sex = sst;	//学生性别

	sst = strtok_s(NULL, " ", &ptr);
	tmp.score1 = atoi(sst);	//学生三门成绩
	sst = strtok_s(NULL, " ", &ptr);
	tmp.score2 = atoi(sst);	//学生三门成绩
	sst = strtok_s(NULL, " ", &ptr);
	tmp.score3 = atoi(sst);	//学生三门成绩
	sst = strtok_s(NULL, " ", &ptr);
	tmp.score_sum = atoi(sst);	//学生三门成绩总分
	//需要包含#include "InfoFile.h"
	CInfoFile file;
	file.ReadDocline(); //读取学生信息
	for (list<msg>::iterator it = file.ls.begin(); it != file.ls.end(); it++)
	{
		if (tmp.id == it->id && tmp.name == it->name && tmp.sex == it->sex && tmp.score1 == it->score1 && tmp.score2 == it->score2 && tmp.score3 == it->score3)
		{
			index = (CString)it->id.c_str();
			name = (CString)it->name.c_str();
			sex = (CString)it->sex.c_str();
			score1 = it->score1;
			score2 = it->score2;
			score3 = it->score3;
			UpdateData(FALSE); //内容更新到对应的控件
		}
	}

}
```

#### (3)确认修改按钮功能实现

```c++
void CModDlg::OnBnClickedButton2()
{
	// TODO: 在此添加控件通知处理程序代码
	CString text;
	int temp = m_combo.GetCurSel();
	m_combo.GetLBText(temp, text);
	std::string STDStr(CW2A(text.GetString()));
	char buf[1024] = { 0 };
	for (int i = 0; i < STDStr.size(); i++)
	{
		buf[i] = STDStr[i];
	}
	msg tmp;
	char* ptr = NULL;
	char* sst = strtok_s(buf, " ", &ptr); //以“ ”切割
	tmp.id = sst; //学生学号

	sst = strtok_s(NULL, " ", &ptr);
	tmp.name = sst;	//学生姓名

	sst = strtok_s(NULL, " ", &ptr);
	tmp.sex = sst;	//学生性别

	sst = strtok_s(NULL, " ", &ptr);
	tmp.score1 = atoi(sst);	//学生三门成绩
	sst = strtok_s(NULL, " ", &ptr);
	tmp.score2 = atoi(sst);	//学生三门成绩
	sst = strtok_s(NULL, " ", &ptr);
	tmp.score3 = atoi(sst);	//学生三门成绩
	sst = strtok_s(NULL, " ", &ptr);
	tmp.score_sum = atoi(sst);	//学生三门成绩总分
	CInfoFile file;
	file.ReadDocline(); //读取学生信息
	for (list<msg>::iterator it = file.ls.begin(); it != file.ls.end(); it++)
	{
		if (tmp.id == it->id && tmp.name == it->name && tmp.sex == it->sex && tmp.score1 == it->score1 && tmp.score2 == it->score2 && tmp.score3 == it->score3 && tmp.score_sum == it->score_sum)
		{
			file.ls.erase(it);
			
			break;
		}
	}
	file.WirteDocline(); //更新文件内容
	UpdateData(TRUE);
	file.Addline(index, name, sex, score1, score2, score3);
	file.WirteDocline();
	MessageBox(_T("修改成功"));
	file.ls.clear(); //清空list的内容
	UpdateData(FALSE);
	m_combo.ResetContent();
	OnInitialUpdate();
}
```

#### (4)取消按钮功能实现

```c++
void CModDlg::OnBnClickedButton1()
{
	// TODO: 在此添加控件通知处理程序代码
	index.Empty();
	name.Empty();
	sex.Empty();
	score1 = 0;
	score2 = 0;
	score3 = 0;
	UpdateData(FALSE);
}
```

------



## 13 查询学生信息窗口实现

### 13.1 ui设计

#### (1)添加对话框资源(ID修改为DIALOG_FIND)，添加所需控件：

<img src="D:\program\C++\项目\学生成绩管理系统.assets\image-20220115212636157.png" alt="image-20220115212636157" style="zoom:80%;" />

在窗口属性中，Border改为None，Style改为Child：

<img src="学生成绩管理系统.assets/image-20220114223401828.png" alt="image-20220114223401828" style="zoom:80%;" />

<img src="学生成绩管理系统.assets/image-20220114223419246.png" alt="image-20220114223419246" style="zoom:80%;" />

#### (2)选中对话框 -> 右击 -> 添加类 -> 类名：CDlgFind，基类选择CFormView

#### (3)根据需求，控件关联所需变量:

<img src="D:\program\C++\项目\学生成绩管理系统.assets\image-20220115212817044.png" alt="image-20220115212817044" style="zoom:80%;" />

### 13.2 功能实现

```c++
void CDlgFind::OnBnClickedButton1()
{
	// TODO: 在此添加控件通知处理程序代码
	UpdateData(TRUE);
	CInfoFile file;
	file.ReadDocline();
	for (list<msg>::iterator it = file.ls.begin();it != file.ls.end();it++)
	{
		if (index == (CString)it->id.c_str() || name == (CString)it->name.c_str())
		{
			CString str;
			index = (CString)it->id.c_str();
			name =  (CString)it->name.c_str();
			sex = (CString)it->sex.c_str();
			score1 = it->score1;
			score2 = it->score2;
			score3 = it->score3;
			score_sum = it->score_sum;
			UpdateData(FALSE);
			MessageBox(_T("查询成功"));
			return;
		}
	}
	MessageBox(_T("查无此人"));
}
```

------



## 14 删除学生信息功能实现

### 14.1  ui实现

#### (1)添加对话框资源(ID修改为DIALOG_FIND)，添加所需控件：

<img src="D:\program\C++\项目\学生成绩管理系统.assets\image-20220115213311264.png" alt="image-20220115213311264" style="zoom:80%;" />

在窗口属性中，Border改为None，Style改为Child：

<img src="学生成绩管理系统.assets/image-20220114223401828.png" alt="image-20220114223401828" style="zoom:80%;" />

<img src="学生成绩管理系统.assets/image-20220114223419246.png" alt="image-20220114223419246" style="zoom:80%;" />

#### (2)选中对话框 -> 右击 -> 添加类 -> 类名：CDelDlg，基类选择CFormView

#### (3)根据需求，控件关联所需变量:

<img src="D:\program\C++\项目\学生成绩管理系统.assets\image-20220115213432832.png" alt="image-20220115213432832" style="zoom:80%;" />

### 14.2  功能实现

#### (1)重写CDelDlg类的OnInitUpdate: 

```c++
void CDelDlg::OnInitialUpdate()
{
	CFormView::OnInitialUpdate();

	// TODO: 在此添加专用代码和/或调用基类
	//读取文件，获取学生信息，给组合框添加字符串
	//需要包含#include "InfoFile.h"
	CInfoFile file;
	file.ReadDocline(); //读取学生信息
	string str;
	for (list<msg>::iterator it = file.ls.begin(); it != file.ls.end(); it++)
	{
		str = it->id;
		str += " ";
		str += it->name;
		str += " ";
		str += it->sex;
		str += " ";
		str += to_string(it->score1);
		str += " ";
		str += to_string(it->score2);
		str += " ";
		str += to_string(it->score3);
		str += " ";
		str += to_string(it->score_sum);
		str += " ";
		m_combo.AddString((CString)str.c_str());
	}
	//将第一个学生信息设为默认选中项
	m_combo.SetCurSel(0);
}
```

#### (2)确认按钮功能实现

```c++
void CDelDlg::OnBnClickedButton1()
{
	// TODO: 在此添加控件通知处理程序代码
	//获取控件上的内容，更新到对应关联的变量中
	UpdateData(TRUE);

	
	CString type;
	//获取当前选中项
	int index = m_combo.GetCurSel();
	//获取组合框当前内容
	m_combo.GetLBText(index, type);
	std::string STDStr(CW2A(type.GetString()));
	char buf[1024] = { 0 };
	for (int i = 0;i < STDStr.size();i++)
	{
		buf[i] = STDStr[i];
	}
	msg tmp;
	char* ptr = NULL;
	char* sst = strtok_s(buf, " ", &ptr); //以“ ”切割
	tmp.id = sst; //学生学号

	sst = strtok_s(NULL, " ", &ptr);
	tmp.name = sst;	//学生姓名

	sst = strtok_s(NULL, " ", &ptr);
	tmp.sex = sst;	//学生性别

	sst = strtok_s(NULL, " ", &ptr);
	tmp.score1 = atoi(sst);	//学生三门成绩
	sst = strtok_s(NULL, " ", &ptr);
	tmp.score2 = atoi(sst);	//学生三门成绩
	sst = strtok_s(NULL, " ", &ptr);
	tmp.score3 = atoi(sst);	//学生三门成绩
	sst = strtok_s(NULL, " ", &ptr);
	tmp.score_sum = atoi(sst);	//学生三门成绩总分
	//需要包含#include "InfoFile.h"
	CInfoFile file;
	file.ReadDocline(); //读取学生信息
	for (list<msg>::iterator it = file.ls.begin(); it != file.ls.end(); it++)
	{
		if (tmp.id == it->id && tmp.name == it->name && tmp.sex == it->sex && tmp.score1 == it->score1 && tmp.score2 == it->score2 && tmp.score3 == it->score3 && tmp.score_sum == it->score_sum)
		{
			file.ls.erase(it);
			MessageBox(_T("删除成功"));
			break;
		}
	}
	file.WirteDocline(); //更新文件内容
	UpdateData(FALSE); //更新到对应的控件
	m_combo.ResetContent();
	OnInitialUpdate();
}
```

#### (3)取消按钮实现

```c++
void CDelDlg::OnBnClickedButton2()
{
	// TODO: 在此添加控件通知处理程序代码
	// TODO:  在此添加控件通知处理程序代码

	m_combo.SetCurSel(0); //选择第0项目

}
```

------



## 15  清空学生信息窗口实现

### 15.1 ui设计

#### (1)设计两个对话框

设计删除对话框(DIALOG_CLEAN)

<img src="D:\program\C++\项目\学生成绩管理系统.assets\image-20220115213846769.png" alt="image-20220115213846769" style="zoom:80%;" />

在窗口属性中，Border改为None，Style改为Child：

<img src="学生成绩管理系统.assets/image-20220114223401828.png" alt="image-20220114223401828" style="zoom:80%;" />

<img src="学生成绩管理系统.assets/image-20220114223419246.png" alt="image-20220114223419246" style="zoom:80%;" />

设计确认删除对话框(DIALOG_ISCLEAN)

<img src="D:\program\C++\项目\学生成绩管理系统.assets\image-20220115214027758.png" alt="image-20220115214027758" style="zoom:80%;" />

#### (2)选中删除对话框 -> 右击 -> 添加类 -> 类名：CDlgClean，基类选择CFormView

选中确认删除对话框 -> 右击 -> 添加类 -> 类名：CDlgIsclean

------



### 15.2 功能实现

#### (1)删除按钮功能实现

```c++
void CDlgClean::OnBnClickedButton1()
{
	// TODO: 在此添加控件通知处理程序代码
	CDlgISclean dlg;
	dlg.DoModal(); //以模态方式运行

}
```

#### (2)确认删除按钮功能实现

```c++
void CDlgISclean::OnBnClickedButton2()
{
	// TODO: 在此添加控件通知处理程序代码
	CInfoFile file;
	file.Clear_file();
	MessageBox(_T("清库成功！！！"));
	OnOK();
}
```

#### (3)取消按钮功能实现

```c++
void CDlgISclean::OnBnClickedButton1()
{
	// TODO: 在此添加控件通知处理程序代码
	OnOK();
}
```

